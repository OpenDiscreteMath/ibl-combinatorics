<?xml version="1.0" encoding="UTF-8"?>

<section xml:id="app3-4-prodprinc" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>The Product Principle for EGFs</title>
  <p>
    One of our major tools for ordinary
    generating functions was the product principle. It is thus natural to
    ask if there is a product principle for exponential generating functions.
    In <xref ref="exponentialbookshelf">Problem</xref> you likely found that the
    EGF for the number of ways of arranging <m>n</m>
    books on one shelf was exactly the same as the EGF for the number of
    permutations of <m>[n]</m>, namely <m>\frac{1}{1-x}</m> or
    <m>(1-x)^{-1}</m>. Then using our formula from <xref ref="bookcase">Problem</xref> and the
    generating function for multisets, you probably found that the EGF for
    number of ways of arranging <m>n</m> books on some fixed number
    <m>m</m> of bookshelves was <m>(1-x)^{-m}</m>. Thus the EGF for <m>m</m> shelves is a
    product of <m>m</m> copies of the EGF for one
    shelf.
  </p>

  <activity xml:id="paintinglightpoles2" category="motivation">
    <statement>
      <p>
        In <xref ref="paintinglightpoles">Problem</xref> what would
        the exponential generating function have been if we had asked for the
        number of ways to paint the poles with just one color of paint? With two
        colors of paint? What is the relationship between the EGF for painting the
        <m>n</m> poles with one color of paint and the EGF for painting the
        <m>n</m> poles with four colors of paint? What is the
        relationship between the EGF
        for painting the <m>n</m> poles with two colors of
        paint and the EGF for painting
        the poles with four colors of paint?
      </p>
    </statement>
    <solution>
      <p>
        With one color of paint, there would have been one way to paint
        each pole so our EGF would be <m>\sum_{n=0}^\infty \frac{x^n}{n!}</m>, or
        <m>e^x</m>. With two colors of paint, it would be <m>e^{2x}</m> by analogy with
        the solution to <xref ref="paintinglightpoles">Problem</xref>. Thus the EGF for two
        colors of paint would be the square of the EGF for one color of paint.
        The EGF for four colors of paint is the fourth power of the EGF for one
        color of paint and the square of the EGF for two colors of paint.
      </p>
    </solution>
  </activity>

  <p>
    In <xref ref="telephonenetwork">Problem</xref> you
    likely found that the EGF for the number of
    network configurations with <m>n</m> customers was <m>e^{x+x^2/2}= e^x \cdot
    e^{x^2/2}</m>. In <xref ref="allonessequence">Problem</xref> you saw that the generating
    function for the number of permutations on <m>n</m> elements that are
    products of one cycles was
    <m>e^x</m>, and in <xref ref="exponentialtennisparings">Problem</xref> you likely found that
    the EGF for the number of tennis pairings of
    <m>2n</m> people, or equivalently, the number of permutations of <m>2n</m> objects
    that are products of <m>n</m> two-cycles is <m>e^{x^2/2}</m>.
  </p>

  <activity xml:id="x2cyclesand1cycles" category="essential for this or the next section">
    <statement>
      <p>
        What can you say about the relationship among the EGF for the
        number of permutations that are products of disjoint two-cycles and
        one-cycles, i.e., are involutions, the exponential generating function for
        the number of permutations that are the product of disjoint two-cycles
        only and the generating function for the number of permutations that are
        the product of disjoint one cycles only (these are identity permutations on their domain)?
      </p>
    </statement>
    <solution>
      <p>
        The EGF for involutions in <m>S_n</m>
        is the product of the EGF for the permutations in <m>S_n</m> that are products
        of <m>n/2</m> two-cycles, and the EGF for permutations in <m>S_n</m> that are
        products of <m>n</m> one-cycles.
      </p>
    </solution>
  </activity>

  <p>
    In <xref ref="exponentialderangements">Problem</xref> you likely found that the
    EGF for the number of permutations of <m>[n]</m>
    that are derangements is <m>\frac{e^{-x}}{1-x}</m>. But every permutation is a
    product of derangements and one cycles, because the permutation that
    sends <m>i</m> to <m>i</m> is a one-cycle, so that when you factor a permutation as
    a product of disjoint cycles, the cycles of size greater than one
    multiply together to give a derangement, and the elements not moved by
    the permutation are one-cycles.
  </p>

  <activity xml:id="derangementsand1cycles" category="essential for this or the next section">
    <statement>
      <p>
        If we multiply the EGF for derangements times the
        EGF for the number of permutations whose cycle decompositions consist of
        one-cycles only, what EGF do
        we get? for what set of objects have we found the EGF?
      </p>
    </statement>
    <hint>
      <p>
    Notice that any permutation is a product of a derangement of the elements
    not fixed by the permutation times a permutation whose cycle decomposition
    consists of one-cycles.
      </p>
    </hint>
    <solution>
      <p>
        We get the EGF <m>\frac{1}{1-x}</m>
        for all permutations of <m>[n]</m>. Notice that any permutation is a product of a derangement of the elements not fixed by the permutation times a permutation whose cycle decomposition consists of one-cycles.
      </p>
    </solution>
  </activity>

  <p>
    We now have four examples in which the EGF
    for a sequence or a pair of objects is the product of the EGFs for the
    individual objects making up the sequence or pair.
  </p>

  <activity xml:id="exponentialpp1" category="essential for this or the next section">
    <statement>
      <p>
        What is the coefficient of <m>\frac{x^n}{n!}</m> in the product of two
        EGFs <m>\sum_{i=0}^\infty a_i\frac{x^i}{i!}</m> and <m>\sum_{j=0}^\infty
        b_j\frac{x^j}{j!}</m>? (A summation sign is appropriate in your
        answer.)
      </p>
    </statement>
    <hint>
      <p>
        A binomial coefficient is likely to appear in your answer.
      </p>
    </hint>
    <solution>
        <p>
            <me>
        \sum_{i,j:\ i+j=n} n!\frac{a_i}{i!}\frac{b_j}{j!},
      </me>
        which can be better
        written as
        <me>
          \sum_{i=0}^n\frac{n!}{i!(n-i)!} a_i
          b_{n-i}=\sum_{i=0}^n\binom{n}{i} a_i b_{n-i}.
        </me>
      </p>
    </solution>
  </activity>

  <!-- <p>
    Our product principle for ordinary generating functions involved the idea
    of a value function. In particular, if we have a set <m>S</m> of objects we
    call a function <m>v</m> from <m>S</m> into the nonnegative
    integers a <term>value function</term>. Our combinatorial interpretation of the
    product of ordinary generating functions in <xref ref="ProductPrincipleOGF">Problem</xref> is the following theorem.
  </p>

  <theorem>
    <statement>
      <p>
        Suppose we have a set <m>S</m> with a value function <m>v</m> from
        <m>S</m> into the nonnegative integers and a set
        <m>T</m> with a value function
        <m>u</m>
        from <m>T</m> into the nonnegative integers. If
        <m>a_i</m> is the number of objects <m>s</m> in <m>S</m> with value <m>v(s) =i</m> and <m>b_j</m>
        is the number of objects <m>t</m> in <m>T</m> with value <m>u(t)= j</m>, and <m>c_n</m> is
        the number of ordered pairs <m>(s,t)</m> of objects in <m>S\times T</m> with total
        value <m>v(s) + u(t) =n</m>, then the ordinary generating function for <m>c_n</m>
        is the product of the ordinary generating function for <m>a_i</m> and the
        ordinary generating function for <m>b_j</m>.
      </p>
    </statement>
  </theorem> -->

  <p>
    <!-- We ask if there is a similar
    interpretation for the products of exponential generating functions we
    have just seen.  -->
    In the case of painting streetlight poles in <xref ref="paintinglightpoles2">Problem</xref>, let us examine the relationship between the EGF for painting poles with two colors, the EGF for painting the poles with three colors, and the EGF for painting poles
    with five colors, <m>e^{5x}</m>. To be specific, the EGF for painting poles red and white is <m>e^{2x}</m> and the EGF for painting poles blue, green, and yellow is <m>e^{3x}</m>. To decide how to paint poles with red, white, blue, green, and yellow, we can decide  which set of poles is to be painted with red and white, and which set of poles is to be painted with blue, green, and yellow. Notice that the number of ways to paint a set of poles with red and white depends only on the size of that set, and the number of ways to paint a set of poles with blue, green, and yellow depends only on the size of that set.
  </p>

  <activity xml:id="exponentialpp2" category="essential for this or the next section">
    <statement>
      <p>
        Suppose that <m>a_i</m> is the number of ways to paint a set of <m>i</m>
        poles with red and white, and <m>b_j</m> is the number of ways to paint a set
        of
        <m>j</m> poles with blue, green, and yellow. In how many ways may we take a set <m>N</m> of <m>n</m> poles, divide it up into two sets <m>I</m> and <m>J</m> (using <m>i</m> to stand for
        the size of <m>I</m> and <m>j</m> to stand for the size of the set <m>J</m>, and allowing <m>i</m> and <m>j</m> to vary) and paint the poles in <m>I</m> red and white
        and the poles in <m>J</m> blue, green, and yellow? (Give your answer in terms of <m>a_i</m> and <m>b_j</m>.  Don't figure out formulas for  <m>a_i</m> and <m>b_j</m> to use in your answer; that will make it harder to get the point of the problem!) How does this relate to <xref ref="exponentialpp1">Problem</xref>?
      </p>
    </statement>
    <solution>
      <p>
        <m>\binom{n}{i}a_ib_j</m>. You could also write the first answer as <m>\binom{n}{i}a_ib_{n-i}</m> or in some other form.  This shows that the coefficient of <m>\frac{x^n}{n!}</m> in the EGF for painting poles with five colors is the coefficient of  <m>\frac{x^n}{n!}</m> in the product of the EGF for painting poles with two
        colors and the EGF for painting poles with three colors.
      </p>
    </solution>
  </activity>

  <p>
    <xref ref="exponentialpp2">Problem</xref> shows that the formula you got for the
    coefficient of <m>\frac{x^n}{n!}</m> in the product of two EGFs is the formula we
    get by splitting a set <m>N</m> of poles into two parts and painting the poles
    in the first part with red and white and the poles in the second part with
    blue, green, and yellow.  More generally, you could interpret your result in
    <xref ref="exponentialpp1">Problem</xref> to say that the coefficient of <m>\frac{x^n}{n!}</m> in the product <m>\sum_{i=0}^\infty a_i \frac{x^i}{i!}
    \sum_{j=0}^\infty b_j\frac{x^j}{j!}</m> of two EGFs is the sum, over all
    ways of splitting a set <m>N</m> of size <m>n</m> into an ordered pair of disjoint sets <m>I</m> and <m>J</m>, of the product
    <m>a_{|I|}b_{|J|}</m>.
  </p>

  <p>
    There seem to be two essential features that relate to the product of exponential generating functions. First, we are considering <term>structures</term><idx><h>structure</h></idx> that consist of a set and
    some additional mathematical construction on or relationship among the
    elements of that set. For example, our set might be a set of light poles and
    the additional construction might be a coloring function defined on that
    set. Other examples of additional mathematical constructions or
    relationships on a set could include a permutation of that set; in
    particular an involution or a derangement, a partition of that set, a graph
    on that set, a connected graph on that set, an arrangement of the elements
    of that set around a circle, or an arrangement of the elements of that set
    on the shelves of a bookcase. In fact a set with no additional construction
    or arrangement on it is also an example of a structure. Its additional
    construction is the empty set!  When a structure consists of the set
    <m>S</m> plus the additional construction, we say the structure
    <em>uses</em> <m>S</m>.<idx><h>uses</h><h>a structure using a set</h></idx><idx><h>structure</h><h>using a set</h></idx> What all the examples we have mentioned in our
    earlier discussion of exponential generating functions have in common is
    that the number of structures that use a given set is determined by the size
    of that set. We will call a family <m>\F</m> of structures a
    <term>species</term><idx><h>species</h></idx> of structures on subsets of a set <m>X</m> if
    structures are defined on finite subsets of <m>X</m> and if the number of
    structures in the family using a finite set <m>S</m> is finite and is
    determined by the size of <m>S</m> (that is, if there is a bijection between
    subsets <m>S</m> and <m>T</m> of <m>X</m>, the number of structures in the
    family that use <m>S</m> equals the number of structures in the family that
    use <m>T</m>). We say a structure is an
    <term><m>\F</m>-structure</term><idx><h>F-structures</h></idx> if it is a
    member of the family <m>\F</m>.
  </p>

<!--
    In contrast, when we multiplied ordinary generating
    functions, the coefficient of
    <m>x^n</m> in
    <m>\sum_{i=0}^\infty a_i x^i
    \sum_{j=0}^\infty b_j x^j</m> is the sum of all <m>a_ib_j</m> over ordered
    pairs of integers <m>i</m> and <m>j</m> with <m>i + j=n</m>. In our combinatorial
    interpretation of the product of two ordinary generating functions, we
    had two sets <m>S</m> and <m>T</m> of objects, <m>a_i</m> was the number of objects in
    <m>S</m> of value <m>i</m>, <m>b_j</m> was the number of objects in <m>T</m> of value <m>j</m>, and
    <m>i+j</m> was the total value of an ordered pair of objects, one from <m>S</m> and
    one from <m>T</m>. In painting poles for streetlights, what was important was
    not only the number of poles we selected to paint red and white, but the
    actual <em>set</em> of poles we selected to paint red and white. This
    suggests that the value of a selection in this context ought to be a set
    instead of simply an integer, even though the size of the set will still
    play a role. For example, the number of ways of paint the poles in a set
    red and white depends only on the size of the set, and not which set we
    choose, but in forming the product of the exponential generating
    functions, we have to analyze all ways of choosing a set of that size.
    This suggests that to get a combinatorial interpretation of the product of
    EGFs we should consider a different kind of value function, one whose
    values are sets and not integers. Thus what we want to consider is a
    <q>set-valued value function.</q> Since this is a mouthful to say, we will
    shorten it in the definition that follows. We define a <term>set-value
    function</term> from a set
    <m>S</m> to a set
    <m>Y</m> to be a function
    <m>V</m> from <m>S</m> to the set of subsets of <m>Y</m> such that for all subsets <m>I</m> of
    <m>Y</m> of the same size, the number of elements <m>s</m> of <m>S</m> whose value
    <m>V(s)</m> is <m>I</m> is the same. For example if <m>S</m> is all ways of painting
    some of the street light poles on the north side on Main Street using red
    and white, and if
    <m>V(s)</m> is the set of poles actually painted red or white, then the number
    of ways to paint some of the poles red and white depends on the size of
    the set of poles being painted, so for each set of poles of a given size,
    the number of ways to paint that set of poles using red and white is the
    same. -->


  <activity category="essential for this or the next section">
    <statement>
      <p>
        In <xref ref="exponentialbookshelf">Problem</xref>, why is the family of arrangements of set of books on a single shelf (assuming they all fit) a species?
      </p>
    </statement>
    <solution>
      <p>
        Because the number of ways to put a set <m>S</m> of books onto a
        shelf is the same (namely <m>|S|!</m>) for all sets <m>S</m> of the same size.
      </p>
    </solution>
  </activity>

  <activity category="essential for this or the next section">
    <statement>
      <p>
        In <xref ref="telephonenetwork">Problem</xref>, why is the family of people actually making phone calls (assuming nobody is
        calling outside the telephone network) at any given time, with the added relationship of who is calling whome, a species? Why is the family of sets of people who are not using their phones a species (with no additional construction needed)?
      </p>
    </statement>
    <solution>
      <p>
        Because the number of ways to break a given set of <m>2n</m> people into
        two-cycles depends only on <m>n</m> and not the particular set of <m>2n</m> people we choose.
        The number of ways to break up a set of size <m>k</m> into
        one-cycles is one, so it doesn't depend on which set of size <m>k</m> we are breaking up.
        (In fact it doesn't depend on <m>k</m> either, but that is irrelevant here.) Of course since these people are doing nothing, the structure of one-cycles is just another way to say that our species consists of sets with no additional structure.
      </p>
    </solution>
  </activity>



  <p>
    The second essential feature of our examples of products of EGFs is that products of EGFs seem to count structures on ordered pairs of two disjoint sets (or more generally on <m>k</m>-tuples of mutually disjoint sets).
    For example, we can determine a five coloring of a set <m>S</m> by partitioning it in all possible ways into two sets and coloring the first set in the pair with our first two colors and our second pair with the last three colors. Or we can partition our set in all possible ways into five parts and color part i with our ith color.
    We don't have to do the same thing to each part of our partition; for example, we could define a derangement on one part and an identity permutation on the other; this defines a permutation on the set we are partitioning, and we have already noted that every permutation arises in this way.
  </p>

  <p>
    Our combinatorial interpretation of EGFs will involve assuming that the coefficient of <m>\frac{x^i}{i!}</m> counts the number of structures on a particular set of of size <m>i</m> in a species of structures on subsets of a set <m>X</m>. <idx><h>species</h><h>exponential generating function for</h></idx>
    Thus in order to give an interpretation of the product of two EGFs we need to be able to think of ordered pairs of structures on disjoint sets or <m>k</m>-tuples of structures on disjoint sets as structures themselves.
    Thus given a structure on a set <m>S</m> and another structure on a disjoint set <m>T</m>, we define the ordered pair of structures (which is a mathematical construction!) to be a structure on the set <m>S\cup T</m>.
    We call this a <term>pair structure</term>
    <idx><h>structure</h><h>pair</h></idx>
    <idx><h>pair structure</h></idx>
     on <m>S\cup T</m>.
    We can get many structures on a set <m>S\cup T</m> in this way, because <m>S\cup T</m> can be divided into many other pairs of disjoint sets.
    In particular, the set of pair structures whose first structure comes from <m>\F</m> and whose second element comes from <m>\mathcal{G}</m> is denoted by <m>\F\cdot \mathcal{G}</m>.
  </p>

  <activity>
    <statement>
      <p>
        Show that if <m>\F</m> and <m>\mathcal{G}</m> are species of structures on subsets of a set <m>X</m>, then the pair of structures of <m>\F\cdot\mathcal{G}</m> for a species of structures
      </p>
    </statement>
    <solution>
      <p>
        We must show that if <m>S</m> and <m>S'</m> are finite subsets of <m>X</m> with the same size, then the number of pair structures on <m>S</m> and the number of pair structures on <m>S'</m> are the same.
        To get a pair structure on <m>S</m> we partition <m>S</m> into two parts, <m>S_1</m> and <m>S_2</m>, take an <m>\F</m> structure on <m>S_1</m> and a <m>\mathcal{G}</m> structure on <m>S_2</m> and form the ordered pair of these structures.
        The number of ways to partition <m>S</m> into sets of size <m>s_1</m> and <m>s_2</m> is the same as the number of ways to partition <m>S'</m> into sets <m>S_1'</m> and <m>S_2'</m> of size <m>s_1</m> and <m>s_2</m> (there are intentionally no primes on the lower case <m>s_1</m> and <m>s_2</m>) and the number of ways to choose an <m>\F</m>-structure on <m>S_1'</m> and a <m>\mathcal{G}</m>-structure on <m>S_2'</m> is the number of ways to make the same choices on <m>S_1</m> and <m>S_2</m>.
        Therefore the number of pairs of structures on the disjoint sets <m>S_1</m> and <m>S_2</m> whose union is <m>S</m> is the same as the number of pairs of structures on the disjoint sets <m>S_1'</m> and <m>S_2'</m> whose union is <m>S'</m>.
        Summing over all ways to partition <m>S</m> or <m>S'</m> into two sets, we find that the number of pair structures on <m>S</m> equals the number of pair structures on <m>S'</m>. Thus the pair structure of <m>\F\cdot \mathcal{G}</m> forms a species of structures.
      </p>
    </solution>
  </activity>

  <p>
    Given a species <m>\F</m> of structures, the number of structures using any particular set of size <m>i</m> is the same as the number of structures in the family using any other set of size <m>i</m>.  We can thus define the exponential generating function (EGF) for the family as the power series <m>\sum_{i=1}^\infty a_i \frac{x^i}{i!}</m>, where <m>a_i</m> is the number of structures of <m>\F</m> that use one particular set of size <m>i</m>.  In <xref ref="egf2n">Problems</xref>,
    <xref ref="paintinglightpoles" text="global"/>,
    <xref ref="exponentialpermutations" text="global"/>,
    <xref ref="exponentialroundtable" text="global"/>,
    <xref ref="exponentialtennisparings" text="global"/>,
    <xref ref="allonessequence" text="global"/>,
    <xref ref="oneblockpartitions" text="global"/>,
    <xref ref="exponentialbookshelf" text="global"/>,
    <xref ref="telephonenetworkEGF" text="global"/>, and
    <xref ref="exponentialderangements" text="global"/>,
    we were computaing EGFs for species of subsets of some set.
  </p>

  <activity>
    <statement>
      <p>
        If <m>\F</m> and <m>\mathcal{G}</m> are species of subsets of <m>X</m>, how is the EGF for <m>\F\cdot \mathcal{G}</m> related to the EGFs for <m>F</m> and <m>G</m>?  Prove you are right.
      </p>
    </statement>
    <hint>
      <p>
        If <m>f(x) = \sum_{i=0}^\infty a_i \frac{x^i}{i!}</m> and <m>g(x) = \sum_{j=0}^\infty b_j\frac{x^j}{j!}</m>, what is the coefficient of <m>\frac{x^n}{n!}</m> in <m>f(x)g(x)</m>?  don't be surprised if your answer has a binomial coefficient in it.  In fact, the binomial coefficient should help you finish the problem.
      </p>
    </hint>
    <solution>
      <p>
        Let <m>f(x)</m>, <m>g(x)</m>, and <m>h(x)</m> be, respectively, the EGFs for the species <m>\F</m>, <m>\mathcal{G}</m>, and <m>\F\cdot\mathcal{G}</m>.  Suppose <m>f(x) = \sum_{i=0}^\infty a_i \frac{x^i}{i!}</m> and <m>g(x) = \sum_{j=0}^\infty b_j\frac{x^j}{j!}</m>.
        Then the coefficient of <m>x^n</m> in <m>f(x)g(x)</m> is <m>\sum_{k=0}^n \frac{a_kb_{n-k}}{i!(n-k)!}</m>, so the coefficient of <m>\frac{x^n}{n!}</m> is
        <me>
          n!\sum_{k=0}^n \frac{a_kb_{n-k}}{i!(n-k)!} = \sum_{k=0}^n \binom{n}{k} a_kb_{n-k}.
        </me>
        But <m>\binom{n}{k}a_kb_{n-k}</m> is the number of ways to partition a set of size <m>n</m> into a first set of size <m>k</m> and a second set of size <m>n-k</m> and to choose a structure for each of them.  That is, it is the number of pair structures on an ordered pair of sets of size <m>k</m> and <m>n-k</m>.  Thus the coefficient of <m>\frac{x^n}{n!}</m> in <m>h(x)</m> is the number of <m>\F\cdot\mathcal{G}</m> pair structures on a subset of <m>X</m> of size <m>n</m>.  This proves that <m>h(x) = f(x)g(x)</m>.
      </p>
    </solution>
  </activity>

  <!-- 398 -->
  <activity xml:id="genspeciesproduct">
    <statement>
      <p>
        Without giving the proof, how can you compute the EGF <m>f(x)</m> for the number of structures using a set of size <m>n</m> in the species <m>\F_1\cdot\F_2\cdot \cdots\cdot \F_k</m> of structures on <m>k</m>-tuples of subsets of <m>X</m> from the EGFs <m>f_i(x)</m> for <m>\F_i</m> for each <m>i</m> from <m>1</m> to <m>k</m>?  (Here we are using the natural extension of the idea of the pair of structures to the idea of a <m>k</m>-tuple structure.)
      </p>
    </statement>
    <solution>
      <p>
        <m>f(x) = \prod_{i=1}^k f_i(x)</m>.
      </p>
    </solution>
  </activity>


  <theorem xml:id="genprodprincipleEGF">
    <statement>
      <p>
        If <m>\F_1, \F_2, \ldots, \F_n</m> are species of subsets of the set <m>X</m> and <m>\F_i</m> has EGF <m>f_i(x)</m>, then the family of <m>k</m>-tuple structures <m>\F_1\cdot \F_2\cdot \cdots\cdot \F_n</m> has EGF <m>\prod_{i=1}^n f_i(x)</m>.
      </p>
    </statement>
  </theorem>



  <p>
    We call <xref ref="genprodprincipleEGF" /> the <term>product principle for exponential generating functions</term>.<idx><h>product
    principle for exponential generating functions</h></idx><idx><h>exponential
    generating functions</h><h>product principle for</h></idx><idx><h>generating
    function</h><h>exponential!product principle for</h></idx>
    We give two corollaries; the proof of the second is not immediate though not particular difficult.
  </p>

  <corollary xml:id="fspeciescorollary1">
    <statement>
      <p>
        If <m>\F</m> is a species of structures on subsets of <m>X</m> and <m>f(x0)</m> is the EGF for <m>\F</m>, then <m>f(x)^k</m> is the EGF for the <m>k</m>-tuple structure on <m>k</m>-tuples of <m>\F</m>-structures using disjoint subsets of <m>X</m>.
      </p>
    </statement>
  </corollary>

  <p>
    Our next corollary uses the idea of a <m>k</m>-set structure.
    Suppose we have a species <m>\F</m> of structures on nonempty subsets of <m>X</m>, that is, a species of structures which assigns no structures to the empty set.
    Then we can define a new species <m>\F^{(k)}</m> of structures, called <q><m>k</m>-set structures,</q> using nonempty subsets of <m>X</m>.
    Given a fixed positive integer <m>k</m>, a <term><m>k</m>-set structure</term><idx><h>k-set structures</h></idx> on a subset <m>Y</m> of <m>X</m> consists of a <m>k</m>-element set of nonempty disjoint subsets of <m>X</m> whose union is <m>Y</m> and an assignment of an <m>\F</m>-structure to each of the disjoint subsets.
    This is a species on the set of subsets of <m>X</m>; the subset used by a <m>k</m>-set structure is the union of the sets of the structure.
    To recapitulate, the set of <m>k</m>-set structures on a subset <m>Y</m> of <m>X</m> is the set of all possible assignments of <m>\F</m>-structures to <m>k</m> nonempty disjoint sets whose union is <m>Y</m>.
    (You can also think of the <m>k</m>-set structures as a family of structures defined on blocks of partitions of subsets of <m>X</m> into <m>k</m> blocks.)
  </p>

  <corollary xml:id="fspeciescorollary2">
    <statement>
      <p>
        If <m>\F</m> is a species of structures on nonempty subsets of <m>X</m> and <m>f(x)</m> is the EGF for <m>\F</m>, then for each positive integer <m>k</m>, <m>\frac{f(x)^k}{k!}</m> is the EGF for the family <m>\F^{(k)}</m> of <m>k</m>-set structures on subsets of <m>X</m>
      </p>
    </statement>
  </corollary>

  <activity>
    <statement>
      <p>
        Prove <xref ref="fspeciescorollary2" />.
      </p>
    </statement>
    <hint>
      <p>
        Since the sets of a <m>k</m>-set structure are nonempty and disjoint, the <m>k</m>-element set of sets can be arranged as a <m>k</m>-tuple in <m>k!</m> ways.
      </p>
    </hint>
    <solution>
      <p>
        Since the sets of a <m>k</m>-set structure are nonepmty and disjoint, the <m>k</m>-element set of sets can be arranged as a <m>k</m>-tuple in <m>k!</m> ways.  Thus the number of <m>k</m>-set structures on a given set is <m>\frac{1}{k!}</m> times the number of <m>k</m>-tuple structures on that set.  Therefore the EGF for <m>k</m>-set structures is <m>\frac{1}{k!}</m> times the EGF for <m>k</m>-tuple structures.  By <xref ref="fspeciescorollary1" />, the EGF for <m>k</m>-set structures is thus <m>\frac{f(x)^k}{k!}</m>.
      </p>
    </solution>
  </activity>


  <activity category="essential for this or the next section">
    <statement>
      <p>
        Use the product principle for EGFs to explain the results of
        <xref ref="x2cyclesand1cycles">Problems</xref> and <xref ref="derangementsand1cycles"></xref>.
      </p>
    </statement>
    <solution>
      <p>
        Every involution is a unique product of disjoint two-cycles and
        one-cycles, so we can think of it as an ordered pair of whose first entry
        is a set of disjoint two-cycles and whose second element is a set of
        disjoint one-cycles. The value of a set of two-cycles is the union of
        their support sets and the value of a set of one-cycles is the union of
        their support sets. Then the EGF for involutions is the product of the
        EGF for permutations that are the product of only disjoint two-cycles and
        the EGF for permutations that are the product of only disjoint one-cycles
        (i.e. identity permutations).
      </p>

      <p>
        We noted in the solution to <xref ref="derangementsand1cycles">Problem</xref> that
        every permutation is the product of a derangement (on the elements that
        are not fixed by the permutation) and a product of one cycles (on the
        elements that are fixed by the permutation). Thus we can think of every
        permutation as an ordered pair consisting of a derangement and a product
        of one-cycles, and the product principle tells us that the EGF for all
        permutations is the product of the EGF for derangements and the EGF for
        identity permutations.
      </p>
    </solution>
  </activity>


  <activity category="essential for this or the next section">
    <statement>
      <p>
        Use the general product principle for EGFs or one of its corollaries to
        explain the relationship between the EGF for painting streetlight poles
        in only one color and the EGF for painting streetlight poles in <m>4</m>
        colors in <xref ref="paintinglightpoles">Problems</xref> and <xref ref="paintinglightpoles2"></xref>.
        What is the EGF
        for the number <m>p_n</m> of ways to paint <m>n</m> streetlight poles
        with some fixed number <m>k</m> of colors of paint.
      </p>
    </statement>
    <solution>
      <p>
        We can think of a painting of a set of street poles as a four-tuple of
        sets, the sets painted each of the four colors. Then <xref ref="fspeciescorollary1">Corollary</xref> tells us that the EGF for such four-tuples is the fourth
        power of the EGF for the number of ways to paint streetlight poles with
        one color. The EGF for painting streetlight poles with <m>k</m> colors of
        paint is <m>e^{kx}</m>.
      </p>
    </solution>
  </activity>

  <activity category="essential for this or the next section">
    <statement>
      <p>
        Use the general product principle for EGFs or one of its corollaries to
        explain the relationship between the EGF for arranging books on one shelf
        and the EGF for arranging books on
        <m>n</m> shelves in <xref ref="exponentialbookshelf">Problem</xref>.
      </p>
    </statement>
    <solution>
      <p>
        An arrangement of books on <m>n</m> shelves may be thought of as a <m>n</m>-tuple
        of arrangements of books on one shelf, and the value of an arrangement
        may be taken to be the set of books actually on the shelf (or shelves).
        The <xref ref="fspeciescorollary1">Corollary</xref> tells us that the EGF is the <m>n</m>th power of
        the EGF for arranging books on one shelf, which is the EGF for
        permutations. Thus the EGF for arranging books on <m>n</m> shelves is
        <m>(1-x)^{-n}</m>.
      </p>
    </solution>
  </activity>

  <activity category="interesting">
      <statement>
        <p>
          (Optional) Our very first example of exponential generating
          functions used the binomial theorem to show that the EGF for <m>k</m>-element
          permutations of an <m>n</m> element set is <m>(1+x)^n</m>. Use the EGF for
          <m>k</m>-element permutations of a one-element set and the product principle
          to prove the same thing. Hint: Review the alternate definition of a
          function in <xref ref="orderedfunctionsection">Section</xref>.
        </p>
      </statement>
      <hint>
        <p>
      The alternate definition of a funciton in <xref ref="orderedfunctionsection">Section</xref> can be restated to
      say that a function from a <m>k</m>-element set <m>K</m> to an <m>n</m>-element set <m>N</m> can be thought of as an <m>n</m>-tuple of sets, perhaps with some empty, whose union is
      <m>K</m>. In order to think of the function as an <m>n</m>-tuple, we number the elements
      of <m>N</m> as number 1 through number <m>n</m>. Then the <m>i</m>th set in the <m>n</m>-tuple is the
      set of elements mapped to the <m>i</m>th element of <m>N</m> in our numbering?
        </p>
      </hint>
      <solution>
        <p>
          In <xref ref="orderedfunctionsection">Section</xref> we remarked that an
          alternate definition of a function from <m>S</m> to <m>T</m> is that it is an
          assignment of disjoint subsets of <m>S</m> to elements of <m>T</m> so that the
          union of the subsets is <m>S</m>. Thus a function from <m>[k]</m> to <m>[n]</m> may be
          thought of as an <m>n</m>-tuple of disjoint subsets of <m>S</m> whose union is
          <m>[k]</m>. In particular, an injection from <m>[k]</m> to <m>[n]</m> (which is a
          <m>k</m>-element permutation of <m>[n]</m>) can be thought of as a <m>n</m>-tuple of
          disjoint singleton sets and empty sets whose union is <m>n</m>. The number of
          such <m>n</m>-tuples is therefore the number of <m>k</m>-element permutations of
          <m>[n]</m>. If <m>n=1</m>, the possible <m>n</m>-tuples are <m>(\emptyset)</m> and <m>\{1\}</m>,
          and so the EGF for such <m>n</m>-tuples is <m>1+x</m>. Then by
          <xref ref="fspeciescorollary1">Corollary</xref>, if we let the value of an <m>n</m>-tuple of
          disjoint singletons and empty sets be the union of the sets in the
          <m>n</m>-tuple, the EGF for the number of <m>n</m>-tuples whose value is <m>[k]</m> is
          <m>(1+x)^n</m>. Thus this is the EGF for <m>k</m>-element permutations of
          <m>[n]</m>.
        </p>
      </solution>
    </activity>
    <activity>
      <statement>
        <p>
          What is the EGF for the number of ways to paint <m>n</m>
          streetlight poles red, white blue, green and yellow, assuming an even
          number of poles must be painted green and an even number of poles must be  painted yellow? Give a formula for the number of ways to paint <m>n</m> poles.  (Don't forget the factorial!)
        </p>
      </statement>
      <hint>
        <p>
          Don't be surprised if you see a hyperbolic sine or hyperbolic cosine in your answer. If you aren't familiar with these functions, look them up in a calculus book.
        </p>
      </hint>
      <solution>
        <p>
          By the product principle for exponential generating functions it
          is
          <me>
            e^{2x}\left(1+\frac{(2x)^2}{2!}+ \frac{(2x)^4}{4!} + \cdots \right) =
            e^{2x}\frac{e^{2x}-e^{-2x}}{2}=e^{2x}\cosh(2x).
          </me>
          Since <m>\cosh(2x) = \sum_{i=0}^\infty \frac{x^{2i}}{(2i)!}</m> and <m>e^{3x}</m> is <m>\sum_{i=0}^\infty 3^i \frac{x^i}{i!}</m>, we have the the coefficient of <m>x^n</m> is <m>\sum_{i=0}^{\lfloor n/2 \rfloor} \frac{3^{n-2i}}{(n-2i)!}\frac{2^{2i}}{(2i)!}</m>,
          and so the number of ways to paint <m>n</m> lightpoles is <m>n!</m> times this, which simplifies to <m>\sum_{i=1}^{\lfloor n/2 \rfloor} \binom{n}{2i} 3^{n-2i}2^{2i}</m>.
        </p>
      </solution>
    </activity>


  <activity category="essential for this or the next section, and interesting">
    <statement>
      <p>
        What is the EGF for the number of functions from an
        <m>n</m>-element set onto a one-element set? (Can there be any functions
        from the empty set onto a one-element set?) What is the EGF for the
        number
        <m>c_n</m> of functions from an <m>n</m>-element set onto a
        <m>k</m> element set (where <m>k</m> is fixed)? Use this EGF to find an explicit
        expression for the number of functions from a <m>k</m>-element set onto an
        <m>n</m>-element set and compare the result with what you got by inclusion and
        exclusion.
      </p>
    </statement>
    <solution>
      <p>
        There are no onto functions from a <m>0</m>-element set to a
        <m>1</m>-element set; otherwise there is exactly one function from an
        <m>n</m>-element set onto a one element set so the EGF for functions from an
        <m>n</m>-element set onto a one element set is <m>e^x-1</m>. A function from an
        <m>n</m>-element set onto a <m>k</m>-element set may be thought of as a <m>k-tuple</m>
        of functions from disjoint subsets whose union is the <m>n</m>-element set
        onto the one element subsets of the <m>k</m>-element set. Therefore by the
        corollary to the product principle for EGFs the EGF for functions from an
        <m>n</m>-element set onto a <m>k</m>-element set is <m>(e^x-1)^k</m>. By the binomial
        theorem, this is
        <me>
          \kern-.25 in\sum_{i=0}^k\binom{k}{i}(-1)^{k-i}e^{ix}
          =
          \sum_{i=0}^k \binom{k}{i} (-1)^{k-i} \sum_{j=0}^\infty \frac{(ix)^j}{j!} =
          \sum_{i=0}^k (-1)^{k-i}\binom{k}{i} \sum_{j=0}^\infty i^j\frac{(x)^j}{j!}.
        </me>
      </p>

      <p>
        Thus <m>c_n= \sum_{i=0}^k(-1)^{k-i}\binom{k}{i}n^i</m>, which is consistent
        with the formula we got by inclusion and exclusion.
      </p>
    </solution>
  </activity>

  <activity xml:id="BellNumbersEGF" category="essential for this or the next section, and interesting">
    <statement>
      <p>
        In <xref ref="BellNumberIntro">Problem</xref> You showed that the Bell Numbers
        <m>B_n</m> satisfy the equation
        <m>B_{n+1} =
        \sum_{k=0}^{n} \binom{n}{k}B_{n-k}</m> (or a similar equation for <m>B_n</m>.)
        Multiply both sides of this equation by <m>\frac{x^n}{n!}</m> and sum from <m>n=0</m>
        to infinity. On the left hand side you have a derivative of a certain
        EGF we might call <m>B(x)</m>. On the right hand side, you
        have a product of two EGFs, one of which is <m>B(x)</m>. What is the other
        one? What differential equation involving <m>B(x)</m> does this give you.
        Solve the differential equation for <m>B(x)</m>. This is the EGF for the
        Bell numbers!.
      </p>
    </statement>
    <solution>
        <p>
            <me>
        \sum_{n=0}^\infty B_{n+1}\frac{x^n}{n!} = \sum_{n=0}^\infty\binom{n}{k}B_{n-k}\frac{x^n}{n!} =\sum_{i=0}^\infty B_{i}\frac{x^{i}}{(i)!}\sum_{j=0}^\infty \frac{x^j}{j!}
      </me>.
        Thus <m>B'(x) = B(x)e^x</m>, which gives us <m>\ln B(x) = e^x+c</m>, or <m>B(x) =
        e^{ex+c} =e^ce^{(e^x)}</m>. Since <m>B_0=B(0)</m> and <m>B_0=1</m>, we have <m>c=-1</m> and
        <m>B(x) = \exp(e^x-1)</m>.
      </p>
    </solution>
  </activity>

  <activity category="interesting">
    <statement>
      <p>
        Prove that <m>n2^{n-1} = \sum_{k=1}^n \binom{n}{k}k</m> by using
        EGFs.
      </p>
    </statement>
    <hint>
      <p>
        The EGF for <m>\sum_{i=1}^n\binom{n}{k}k</m> is <m>\sum_{n=1}^\infty \sum_{i=1}^n \frac{n!}{k!(n-k)!}k\frac{x^n}{n!}</m>.  You can cancel out the <m>n!</m> terms and the <m>k</m> terms.  Now try to see if what is left can be regarded as the product of two EGFs.
      </p>
    </hint>

    <solution>
      <p>
        By the product principle for EGFs, the EGF for the right hand
        side is
        <me>
          e^x\cdot xe^x =xe^{2x}=x\sum_{i=o}^\infty \frac{(2x)^i}{i!} =
          \sum_{j=1}^\infty 2^{j-1}\frac{x^j}{(j-1)!}=\sum_{j=1}^\infty
          j2^{j-1}\frac{x^j}{j!}.
        </me>
      </p>

      <p>
        Thus the coefficient of <m>\frac{x^n}{n!}</m> is
        <m>n2^{n-1}</m>, as well as <m>\sum_{k=1}^n \binom{n}{k}k</m>.
      </p>
    </solution>
  </activity>

  <activity category="essential for this or the next section">
    <statement>
      <p>
        In light of <xref ref="oneblockpartitions">Problem</xref>, why is the EGF for
        the Stirling numbers
        <m>S(n,k)</m> of the second kind not
        <m>(e^x -1)^n</m>? What is it equal to instead?
      </p>
    </statement>
    <solution>
      <p>
        Notice that a one block partition is the same thing as a
        function from that block onto a one element set. However a partition
        with <m>n</m> blocks is not an <m>n</m>-tuple of blocks, but rather a set of <m>n</m>
        blocks. An <m>n</m>-tuple of blocks corresponds to a function from the union
        of the blocks onto an <m>n</m>-element set, and <m>n!</m> different onto functions
        correspond to the same partition into <m>n</m> blocks. Thus the EGF for
        partitions of an <m>n</m>-element set into <m>k</m> parts (where <m>n</m> is fixed but
        <m>k</m> varies) is <m>\frac{1}{n!} (e^x -1)^n</m>.  We could also use <xref ref="fspeciescorollary2" /> directly.
      </p>
    </solution>
  </activity>

  <!-- <p>
    The idea of the set-value function in the product principle for
    exponential generating functions helps to resolve a mystery that you may
    have been consciously or unconsciously wondering about. How do we know
    when ordinary generating functions will be most useful and how do we know
    when exponential generating functions will be most useful? When we are
    in a situation<mdash />such as distributing fruit to children, or partitioning
    an integer<mdash />where a combinatorial structure is determined by the number
    of objects of a certain type (for example a partition of an integer is
    determined by the number of ones, the number of twos and so on), ordinary
    generating functions are most likely to be useful. However when what
    determines a combinatorial structure is the set of objects, or some
    structure (such as a permutation) on a set of objects, then exponential
    generating functions are most likely to be useful. In particular, in
    situations where our structure comes with labels, then exponential
    generating functions are likely to be useful. However there is a gray
    area. When we are distributing identical candy to children, the children
    are labelled (they have names), but the candy is not. Experience tells
    us, though that since the candy is not labelled, ordinary generating
    functions are useful. So while the question of whether the most natural
    value function seems to be an integer value or a set-value is a good
    guideline, in the end experience helps tremendously!
  </p> -->
</section>
